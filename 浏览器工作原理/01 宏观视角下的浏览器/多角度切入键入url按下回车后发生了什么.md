# 输入url再到按下回车，背后都发生了什么？



## http协议角度

1. HTTP协议底层基于TCP/IP协议，因此第一件事情是获取IP地址，如果输入的url是域名，首先要进行**域名DNS解析。**
2. 通过DNS域名解析后获得服务器IP地址和端口号，浏览器用TCP三次握手与服务器建立连接。
3. 浏览器向服务器发送拼接好的报文。
4. 服务器端相应数据发送回浏览器。
5. 浏览器解析报文，开始渲染页面。



## 缓存

为了加快数据获取的速度，几乎每一步都存在“短路”操作，操作的手段就是缓存。



**DNS**

有些网站的IP地址是动态的，因此每次都需要DNS域名解析。

DNS 协议开始从操作系统(hosts文件）、本地 DNS、根 DNS、顶级 DNS、权威 DNS 的层层解析，这之中都有缓存。



**CDN**

别忘了互联网上还有另外一个重要的角色 CDN，它也会在 DNS 的解析过程中“插上一脚”。DNS 解析可能会给出 CDN 服务器的 IP 地址，这样你拿到的就会是 CDN 服务器而不是目标网站的实际地址。

因为 CDN 会缓存网站的大部分资源，比如图片、CSS 样式表...



由 PHP、Java 等后台服务动态生成的页面属于“动态资源”，CDN 无法缓存，只能从目标网站获取。于是你发出的 HTTP 请求就要开始在互联网上的“漫长跋涉”，经过无数的路由器、网关、代理，最后到达目的地。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200913222301859.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pIZ29nb2dvaGE=,size_16,color_FFFFFF,t_70#pic_center)

目标网站的服务器对外表现的是一个 IP 地址，但为了能够扛住高并发，在内部也是一套复杂的架构。通常在入口是负载均衡设备，例如四层的 LVS 或者七层的 Nginx，在后面是许多的服务器，构成一个更强更稳定的集群。



负载均衡设备会先访问缓存服务器，它们的作用与CDN类似，不过是工作在内部网络里，把最频繁访问的数据存储几秒或几分钟，减轻后端服务器的压力。



如果缓存服务器也没有需要的数据，那么负载均衡设备就要把请求转发给应用服务器了，它们还会访问后面的MySQL等数据库服务，实现用户登录等..操作，把执行的结果返回给负载均衡设备。

应用服务器的输出到了负载均衡设备这里，请求的处理就算是完成了，就要按照原路再走回去，还是要经过许多的路由器、网关、代理。**如果这个资源允许缓存，那么经过 CDN 的时候它也会做缓存，这样下次同样的请求就不会到达源站了。**