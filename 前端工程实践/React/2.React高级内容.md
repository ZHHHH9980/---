# 高级应用



## 参数校验

### PropTypes

对`props`进行校验。

```js
import PropTypes from 'prop-types';

MyComponent.propTypes = {
  // You can declare that a prop is a specific JS type. By default, these
  // are all optional.
  optionalArray: PropTypes.array,
  optionalBool: PropTypes.bool,
  optionalFunc: PropTypes.func,

// 多种类型
// An object that could be one of many types
  optionalUnion: PropTypes.oneOfType([
    PropTypes.string,
    PropTypes.number,
    PropTypes.instanceOf(Message)
  ]),
}
```



### isRequired

必须要传入的参数

```react
import PropTypes from 'prop-types';

class MyComponent extends React.Component {
  render() {
    // This must be exactly one element or it will warn.
    const children = this.props.children;
    return (
      <div>
        {children}
      </div>
    );
  }
}

MyComponent.propTypes = {
  children: PropTypes.element.isRequired
};
```



### Default Prop Values

```react
class Greeting extends React.Component {
  render() {
    return (
      <h1>Hello, {this.props.name}</h1>
    );
  }
}

// Specifies the default values for props:
Greeting.defaultProps = {
  name: 'Stranger'
};
```



## Props,state,render之间的关系

1. Props,state更新都会**重新执行Component中的render函数；**
2. 父组件render执行，子组件中的render也会重新执行；



## 虚拟DOM

模拟一个场景，一段DOM片段中的input输入框中的内容发生变化，span标签中的内容也发生变化；

1. 传统的操作方式

```react
let str = 
`<div>
    <input type="text">
    <span>${inputValue}</span>
</div>`;
document.body.innerHTML = str;
input.onchange = (e) => {
    inputValue = e.value;
    document.body.innerHTML = str;
}
```

缺陷：

- 每次都需要生成整块DOM，替换原来的DOM，**非常消耗性能**；



2. 比对DOM差异
   1. 根据数据变化生成新的DOM，存储到DocumentFragment中
   2. 新的DOM跟原来的DOM进行差异比对
   3. 对发生变化的DOM进行替换

缺陷：

- 第二步DOM之间的差异比对非常消耗性能



3. 虚拟DOM
   - 核心思想是**用JS中的对象对DOM进行描述**

```react
<div>
    <span id="abc">hello world</span>
</div>
let obj = ['div',{},['span',{id:"abc"},'hello world']] 
```

更新span

```react
<div>
	<span id="abc">game over</span>
</div>
let obj = ['div',{},['span',{id:"abc"},'game over']]
```

对比两个对象之间的差异，从而对相应的DOM元素进行替换

优势：

- 在JS中，**对象之间差异的比对带来的性能消耗远小于直接获取DOM进行比较**，极大提升了性能；

